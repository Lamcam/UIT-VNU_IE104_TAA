<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Trang web TAA là một nền tảng thương mại
    điện tử chuyên về bán đồ phụ kiện trang sức. Với sự tập trung vào việc cung
    cấp những sản phẩm chất lượng cao và thiết kế độc đáo, TAA đã trở thành
    điểm đến lý tưởng cho những người đam mê phụ kiện và trang sức.">
  <link rel="icon" type="image/svg+xml" href="/logos/favicon.svg">
  <link rel="stylesheet" href="/styles/pages/base.css">
  <link rel="stylesheet" href="/styles/pages/products/index.css">
  <title>TAA - Trang sản phẩm</title>
</head>

<body>
  <div id="main" class="on-primary">
    <%- include('../../partials/header', { activeIdx: 1 }) %>
    <%- include('../../partials/breadcrumbs', { 
      data: [
        { label: 'Trang chủ', link: '/' },
        { label: 'Sản phẩm', link: '/products' }
      ]
    }) %>

    <div id='theFilter' class='mt-12'>
      <div class="container">
        <div class="product__filter visible">
          <p class="product__title label-large on-surface-text">Sắp xếp theo</p>
          <button class="product__button js-button btn--outlined">
            <span class="material-symbols-outlined icon-check">
              check
            </span>
            Giảm giá
          </button>
          <button class="product__button js-button btn--outlined">
            <span class="material-symbols-outlined icon-check">
              check
            </span>
            Bán chạy nhất
          </button>
          <div class="dropdown label-large">
            <div class="select product__button">
              <span class="material-symbols-outlined icon-check">
                check
              </span>
              <span class="selected selected2">Giá</span>
              <div class="caret"></div>
              <span class="material-symbols-outlined icon-cancel">
                close
              </span>
            </div>
            <ul class="menu">
              <li class="select__active">Giá: Từ thấp đến cao</li>
              <li>Giá: Từ cao đến thấp</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row mt-12">
        <aside class="aside col-12 col-lg-3">
          <ul class="aside__list body-large primary-text visible">
            <li class="aside__item">
              <span class="aside__item__title">
                <span class="material-symbols-outlined icon-menu">
                  menu
                </span>
                Danh mục sản phẩm
              </span>
            </li>
            <li class="aside__item js-item">
              <span class="aside__header">Trang sức</span>
              <ul class="aside__item__sub-menu js-sub-menu">
                <li class="category" data-category="vong_co"><span>Vòng cổ</span></li>
                <li class="category" data-category="vong_tay"><span>Vòng tay</span></li>
                <li class="category" data-category="hoa_tai"><span>Hoa tai</span></li>
                <li class="category" data-category="nhan"><span>Nhẫn</span></li>
              </ul>
            </li>
            <li class="aside__item js-item">
              <span class="aside__header">Phụ kiện tóc</span>
              <ul class="aside__item__sub-menu js-sub-menu">
                <li class="category" data-category="kep"><span>Kẹp</span></li>
                <li class="category" data-category="day_cot_toc"><span>Dây cột tóc</span></li>
                <li class="category" data-category="cai_toc"><span>Cài tóc</span></li>
                <li class="category" data-category="tram_cai"><span>Trâm cài</span></li>
              </ul>
            </li>
            <li class="aside__item js-item">
              <span class="aside__header">Túi ví</span>
              <ul class="aside__item__sub-menu js-sub-menu">
                <li class="category" data-category="balo"><span>Balo</span></li>
                <li class="category" data-category="tui_xach"><span>Túi</span></li>
                <li class="category" data-category="vi"><span>Ví</span></li>
              </ul>

            </li>
            <li class="aside__item js-item">
              <span class="aside__header">Khác</span>
              <ul class="aside__item__sub-menu js-sub-menu">
                <li class="category" data-category="thiep"> <span>Thiệp</span></li>
                <li class="category" data-category="op_lung"><span>Ốp lưng</span></li>
                <li class="category" data-category="mat_kinh"><span>Mắt kính</span></li>
                <li class="category" data-category="day_deo"><span>Dây đeo</span></li>
                <li class="category" data-category="mu_non"><span>Mũ nón</span></li>
                <li class="category" data-category="khau_trang"><span>Khẩu trang</span></li>
              </ul>
            </li>
          </ul>
        </aside>

        <main class="visible row col-12 col-lg-9">
          <div class="row col-12 product__wrapper">
            <%  const length = (result.length > 9) ? 9 : result.length;
            for (let idx = 0; idx < length; ++idx) { %>
            <%- include('../../components/product__item', {
                data: result[idx],
              }) %>
            <%# include('../../components/popup__product', {
                data: result[idx],
              })%>
            <% } %>
          </div>

          <div class="row col-12">
            <%- include('../../partials/pagination', {
              classList: 'col-12'
            }) %>
          </div>
        </main>
      </div>
    </div>

    <!-- Modal -->




    <%- include('../../partials/footer') %>
  </div>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script type="module" src="/scripts/modules/main.js"></script>
  <script src="/scripts/pages/products/index.js"></script>

  <script>
    const category = document.querySelectorAll(".category");

    function createProduct(item) {
      let path = "/imgs/products/" + item.cate_name + "/";
      // Create the outer container div
      console.log("this is path", path);
      let productItem = document.createElement("div");
      productItem.classList.add("product__item", "col-4","col-sm-6");

      // Create the product image container div
      let productImage = document.createElement("div");
      productImage.classList.add("product__image");
      productItem.appendChild(productImage);

      // Create the front image element
      let frontImage = document.createElement("img");
      frontImage.src = path + item.prod_img_urls[1];

      frontImage.alt = "ảnh sản phẩm";
      frontImage.classList.add("img_back");
      productImage.appendChild(frontImage);

      // Create the back image element
      let backImage = document.createElement("img");
      // backImage.src = "../../../public/red-panda-small.jpg";
      backImage.src = path + item.prod_img_urls[0];
      backImage.alt = "ảnh sản phẩm";
      backImage.classList.add("img_font");
      productImage.appendChild(backImage);

      // Create the product body div
      let productBody = document.createElement("div");
      productBody.classList.add("product__body");
      productItem.appendChild(productBody);

      // Create the heart icon element
      let heartIcon = document.createElement("span");
      heartIcon.classList.add(
        "material-symbols-outlined",
        "icon_heart",
        "error-text"
      );
      heartIcon.textContent = "heart_plus";
      productBody.appendChild(heartIcon);

      // Create the product name heading
      let productName = document.createElement("h3");
      productName.classList.add("product__name", "body-large");
      productName.textContent = `${item.prod_name}`;
      productBody.appendChild(productName);

      // Create the product price container div
      let productPrice = document.createElement("div");
      productPrice.classList.add("product__price", "label-large");
      productBody.appendChild(productPrice);

      // Create the current price element
      let currentPrice = document.createElement("p");
      currentPrice.classList.add("product__price__current");
      currentPrice.textContent = `${parseInt(item.prod_cost)*(1- parseFloat(item.prod_discount))}`;
      productPrice.appendChild(currentPrice);

      // Create the discounted price element
      let discountedPrice = document.createElement("p");
      discountedPrice.classList.add(
        "product__price__discount",
        "outline-variant-text"
      );
      discountedPrice.textContent = `${item.prod_cost}`;
      productPrice.appendChild(discountedPrice);

      // Create the product discount paragraph
      let productDiscount = document.createElement("p");
      productDiscount.classList.add(
        "product__discount",
        "title-medium",
        "error-text"
      );
      productDiscount.textContent = `Giảm ${item.prod_discount*100}%`;
      productBody.appendChild(productDiscount);

      // Create the product stock label
      let productStock = document.createElement("p");
      let prodAvai = parseInt(item.prod_num_avai);
      let state = "";
      prodAvai ? state = 'Còn hàng' : state = "Hết hàng";
      productStock.classList.add(
        "product__stock",
        "label-large",
        "primary-text"
      );

      productStock.textContent = state;
      productBody.appendChild(productStock);

      // Create the product button section div
      let productButtonSection = document.createElement("div");
      productButtonSection.classList.add(
        "product__button__section",
        "label-large"
      );
      productItem.appendChild(productButtonSection);

      // Create the quick view button
      let quickViewButton = document.createElement("div");
      quickViewButton.classList.add("product__button__view");
      quickViewButton.textContent = "Xem nhanh";
      productButtonSection.appendChild(quickViewButton);

      // Create the vertical separator div
      let verticalSeparator = document.createElement("div");
      verticalSeparator.classList.add("vertical");
      productButtonSection.appendChild(verticalSeparator);

      // Create the buy now button with link
      let buyNowButton = document.createElement("div");
      buyNowButton.classList.add("product__button__sell");
      productButtonSection.appendChild(buyNowButton);

      let buyNowLink = document.createElement("a");
      buyNowLink.href = "/TAA_FE/src/homepage/cartPage/index.html";
      buyNowLink.textContent = "Mua ngay";
      buyNowButton.appendChild(buyNowLink);

      // Append the product item to the desired container/element
      let container = document.querySelector(".product__wrapper");
      container.appendChild(productItem);
    }

    category.forEach((item) => {
      item.addEventListener("click", () => {
        const selectedCategory = item.dataset.category;
        fetch("http://localhost:3000/products/category", {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            // body: JSON.stringify({ category: selectedCategory })
            body: JSON.stringify({
              category: selectedCategory
            })
          }).then(respone => respone.json())
          .then(data => {
            console.log("this is data :", data.result);
            $(".product__wrapper").empty();
            data.result.forEach(item => {
              createProduct(item);

            })



          })
      });
    });
  </script>
</body>

</html>