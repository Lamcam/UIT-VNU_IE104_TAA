<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/styles/pages/base.css">
  <link rel="stylesheet" href="/styles/pages/products/index.css">
  <title>TAA - Trang sản phẩm</title>
</head>

<body>
  <div id="main" class="on-primary">
    <%- include('../../partials/header', { activeIdx: 1 }) %>
    <%- include('../../partials/breadcrumbs', { 
      data: [
        { label: 'Trang chủ', link: '/' },
        { label: 'Sản phẩm', link: '/products' }
      ]
    }) %>

    <div id='theFilter' class='mt-12'>
      <div class="container">
        <div class="product__filter visible">
          <p class="product__title label-large on-surface-text">Sắp xếp theo</p>
          <button class="product__button js-button btn--outlined">
            <span class="material-symbols-outlined icon-check">
              check
            </span>
            Giảm giá
          </button>
          <button class="product__button js-button btn--outlined">
            <span class="material-symbols-outlined icon-check">
              check
            </span>
            Bán chạy nhất
          </button>
          <div class="dropdown label-large">
            <div class="select product__button">
              <span class="material-symbols-outlined icon-check">
                check
              </span>
              <span class="selected selected2">Giá</span>
              <div class="caret"></div>
              <span class="material-symbols-outlined icon-cancel">
                close
              </span>
            </div>
            <ul class="menu">
              <li class="select__active">Giá: Từ thấp đến cao</li>
              <li>Giá: Từ cao đến thấp</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Dành cho việc chia cột nội dung-->
    <div class="container">
      <div class="row mt-12">
        <aside class="aside col-12 col-lg-3">
          <ul class="aside__list body-large primary-text visible">
            <li class="aside__item">
              <span class="aside__item__title">
                <span class="material-symbols-outlined icon-menu">
                  menu
                </span>
                Danh mục sản phẩm
              </span>
            </li>
            <li class="aside__item js-item">
              <span class="aside__header">Trang sức</span>
              <ul class="aside__item__sub-menu js-sub-menu">
                <li class="category" data-category="Vong_co" ><span>Vòng cổ</span></li>
                <li class="category" data-category="Vong_tay" ><span>Vòng tay</span></li>
                <li class="category" data-category="Hoa_tai" ><span>Hoa tai</span></li>
                <li class="category" data-category="Nhan" ><span>Nhẫn</span></li>
              </ul>
            </li>
            <li class="aside__item js-item">
              <span class="aside__header">Phụ kiện tóc</span>
              <ul class="aside__item__sub-menu js-sub-menu">
                <li class="category" data-category="Kep" ><span>Kẹp</span></li>
                <li class="category" data-category="Day_cot_toc" ><span>Dây cột tóc</span></li>
                <li class="category" data-category="Cai_toc" ><span>Cài tóc</span></li>
                <li class="category" data-category="Tram_cai" ><span>Trâm cài</span></li>
              </ul>
            </li>
            <li class="aside__item js-item">
              <span class="aside__header">Túi ví</span>
              <ul class="aside__item__sub-menu js-sub-menu">
                <li class="category" data-category="Balo"><span>Balo</span></li>
                <li class="category" data-category="Tui"><span>Túi</span></li>
                <li class="category" data-category="Vi"><span>Ví</span></li>
              </ul>

            </li>
            <li class="aside__item js-item">
              <span class="aside__header">Khác</span>
              <ul class="aside__item__sub-menu js-sub-menu">
                <li class="category" data-category="Thiep" > <span>Thiệp</span></li>
                <li class="category" data-category="Op_lung" ><span>Ốp lưng</span></li>
                <li class="category" data-category="Mat_kinh" ><span>Mắt kính</span></li>
                <li class="category" data-category="Day_deo" ><span>Dây đeo</span></li>
                <li class="category" data-category="Mu_non" ><span>Mũ nón</span></li>
                <li class="category" data-category="Khau_trang" ><span>Khẩu trang</span></li>
              </ul>
            </li>
          </ul>
        </aside>

        <main class="visible row col-12 col-lg-9">
          <div class="row col-12 product__wrapper">
           <%  const length = (result.length > 9) ? 9 : result.length;
            for (let idx = 0; idx < length; ++idx) { %>
            <%- include('../../components/product__item', {
                data: result[idx],
              }) %>
            <% } %>
          </div>
          <div class="row col-12">
            <%- include('../../partials/pagination', {
              classList: 'col-12'
            }) %>
          </div>
        </main>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal-product">
      <div class="modal-container--product">
        <div class="modal__img">
          <div class="img-display">
            <div class="img-showcase">
              <img src="/imgs/products/product2.jpg" alt="Product img">
              <img src="/imgs/products/product3.jpg" alt="Product img">
              <img src="/imgs/products/product4.jpg" alt="Product img">
              <img src="/imgs/products/product7.jpg" alt="Product img">
            </div>
          </div>
          <div class="img-select">
            <div class="img-item">
              <a href="#" data-id="1">
                <img src="/imgs/products/product2.jpg" alt="product image">
              </a>
            </div>
            <div class="img-item">
              <a href="#" data-id="2">
                <img src="/imgs/products/product3.jpg" alt="product image">
              </a>
            </div>
            <div class="img-item">
              <a href="#" data-id="3">
                <img src="/imgs/products/product4.jpg" alt="product image">
              </a>
            </div>
            <div class="img-item">
              <a href="#" data-id="4">
                <img src="/imgs/products/product7.jpg" alt="product image">
              </a>
            </div>
          </div>
        </div>
        <div class="modal__body">
          <p class="modal__product__name headline-medium">Tên sản phẩm</p>
          <div class="modal__info__rate">
            <div class="rate__star title-medium">
              4.8
              <span class="material-symbols-outlined icon--filled">
                star
              </span>
              <span class="material-symbols-outlined icon--filled">
                star
              </span>
              <span class="material-symbols-outlined icon--filled">
                star
              </span>
              <span class="material-symbols-outlined icon--filled">
                star
              </span>
              <span class="material-symbols-outlined icon--filled">
                star_rate_half
              </span>
            </div>
            <span class="rate__number title-medium">30 đánh giá</span>
            <span class="number__buy title-medium">300 đã bán</span>
          </div>
          <div class="modal__price">
            <p class="cost body-medium">180.000đ</p>
            <p class="cost__discount headline-small">79.000đ</p>
            <div class="percent__discount body-medium">42% giảm</div>
          </div>
          <div class="modal__color label-large">
            <p class="color__title bold">Màu sắc:</p>
            <div class="color__value outline-text">Xanh lá cây</div>
          </div>
          <div class="modal__size label-large">
            <p class="size__title bold">Kích thước:</p>
            <div class="size__value outline-text">Freestyle</div>
          </div>
          <div class="modal__quantity">
            <div class="quantity__title label-large bold">Số lượng: </div>
            <div class="quantity__product outline-text label-large">
              <div id="decrement" class="quantity__product-decrement outline-text" onclick="stepper(this)">-</div>
              <input type="number" min="0" max="100" step="1" value="1" id="my-input" disabled>
              <div id="increment" class="quantity__product-increment outline-text" onclick="stepper(this)">+</div>
            </div>
            <p class="quantity__stock body-small">82 sản phẩm sẵn có</p>
          </div>
          <div class="modal__button">
            <button class="button__cart">
              <span class="material-symbols-outlined">
                add_shopping_cart
              </span>
              Thêm vào giỏ hàng
            </button>
            <button class="button__view btn--filled">
              <a href="/products/detail?id=1">Xem chi tiết</a>
            </button>
          </div>
          <div class="modal__context body-large">
            <div class="context__info mt-12">
              <div class="context__info__title">
                THÔNG TIN SẢN PHẨM
              </div>
              <ul class="context__info__body">
                <li>Chất liệu vải: Kaki cao cấp.</li>
                <li>Khóa chỉnh size: Được làm bằng inox.</li>
                <li>Phong cách Unisex, phù hợp Nam/Nữ.</li>
              </ul>
            </div>
            <div class="context__detail mt-24">
              <div class="context__detail__title">
                MÔ TẢ SẢN PHẨM
              </div>
              <ul class="context__detail__body">
                <li>- Form dáng chuẩn, chắc chắn, form mềm giúp định hình được khuôn mặt.</li>
                <li>- Nón được thiết kế để bảo vệ cho vùng mắt, vùng da mặt, da đầu và tóc tránh các tia cực tím độc hại
                  từ ánh nắng mặt trời.</li>
                <li>- Giặt bằng nước lạnh không dùng bột giặt trong lần giặt đầu tiên.</li>
                <!-- <li>- Thiết kế may tinh tế, sắc sảo và thời trang, theo phong cách Ulzzang Hàn Quốc cá tính.</li>
                <li>- Hạn chế gây ra mồ hôi ở đầu, không gây kích ứng da đầu.</li>
                <li>- Phần đai nón có đệm bông tạo cảm giác thoải mái khi đội nón và không để lại vết hằn lên trán.</li>
                <li>- Khóa chỉnh size phía sau nón được làm bằng inox không gỉ rất dễ dàng sử dụng điều chỉnh nón.</li> -->
              </ul>
            </div>
          </div>
        </div>
        <div class="btn--close">
          <span class="material-symbols-outlined">
            close
          </span>
        </div>
      </div>
    </div>

    <div class="modal-noti">
      <div class="modal-container--noti on-primary-text">
        <div class="noti__icon-check">
          <span class="material-symbols-outlined icon--filled">
            check_circle
          </span>
        </div>
        <p class="noti__text headline-large">Thêm vào giỏ hàng thành công</p>
        <div class="noti__btn btn--close">
          <span class="material-symbols-outlined">
            close
          </span>
        </div>
      </div>
    </div>

    <%- include('../../partials/footer') %>
  </div>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script type="module" src="/scripts/modules/main.js"></script>
  <script src="/scripts/pages/products/index.js"></script>
  <script>
    
  </script>
  <script>

      const category = document.querySelectorAll(".category");
      
      function createProduct(item) {
       
      let path = "/TAA_FE/public/imgs/products/" + item.cate_name + "/" + item.prod_img_urls[0] ;
      // Create the outer container div
      let productItem = document.createElement("div");
      productItem.classList.add("product__item", "col-4");

      // Create the product image container div
      let productImage = document.createElement("div");
      productImage.classList.add("product__image");
      productItem.appendChild(productImage);

      // Create the front image element
      let frontImage = document.createElement("img");
      // frontImage.src = `${item.prod_img_url}`;
      frontImage.alt = "Kẹp tóc";
      frontImage.classList.add("img_back");
      productImage.appendChild(frontImage);

      // Create the back image element
      let backImage = document.createElement("img");
      // backImage.src = "../../../public/red-panda-small.jpg";
      backImage.src = path;
      backImage.alt = "Kẹp tóc";
      backImage.classList.add("img_font");
      productImage.appendChild(backImage);

      // Create the product body div
      let productBody = document.createElement("div");
      productBody.classList.add("product__body");
      productItem.appendChild(productBody);

      // Create the heart icon element
      let heartIcon = document.createElement("span");
      heartIcon.classList.add(
        "material-symbols-outlined",
        "icon_heart",
        "error-text"
      );
      heartIcon.textContent = "heart_plus";
      productBody.appendChild(heartIcon);

      // Create the product name heading
      let productName = document.createElement("h3");
      productName.classList.add("product__name", "body-large");
      productName.textContent = `${item.prod_name}`;
      productBody.appendChild(productName);

      // Create the product price container div
      let productPrice = document.createElement("div");
      productPrice.classList.add("product__price", "label-large");
      productBody.appendChild(productPrice);

      // Create the current price element
      let currentPrice = document.createElement("p");
      currentPrice.classList.add("product__price__current");
      currentPrice.textContent = `${parseInt(item.prod_cost)*(1- parseFloat(item.prod_discount))}`;
      productPrice.appendChild(currentPrice);

      // Create the discounted price element
      let discountedPrice = document.createElement("p");
      discountedPrice.classList.add(
        "product__price__discount",
        "outline-variant-text"
      );
      discountedPrice.textContent = `${item.prod_cost}`;
      productPrice.appendChild(discountedPrice);

      // Create the product discount paragraph
      let productDiscount = document.createElement("p");
      productDiscount.classList.add(
        "product__discount",
        "title-medium",
        "error-text"
      );
      productDiscount.textContent = `${item.prod_discount*100}`;
      productBody.appendChild(productDiscount);

      // Create the product stock label
      let productStock = document.createElement("p");
      let prodAvai = parseInt(item.prod_num_avai);
      let state = "";
      prodAvai ? state = 'Còn hàng': state = "Hết hàng" ;
      productStock.classList.add(
        "product__stock",
        "label-large",
        "primary-text"
      );
      
      productStock.textContent = state;
      productBody.appendChild(productStock);

      // Create the product button section div
      let productButtonSection = document.createElement("div");
      productButtonSection.classList.add(
        "product__button__section",
        "label-large"
      );
      productItem.appendChild(productButtonSection);

      // Create the quick view button
      let quickViewButton = document.createElement("div");
      quickViewButton.classList.add("product__button__view");
      quickViewButton.textContent = "Xem nhanh";
      productButtonSection.appendChild(quickViewButton);

      // Create the vertical separator div
      let verticalSeparator = document.createElement("div");
      verticalSeparator.classList.add("vertical");
      productButtonSection.appendChild(verticalSeparator);

      // Create the buy now button with link
      let buyNowButton = document.createElement("div");
      buyNowButton.classList.add("product__button__sell");
      productButtonSection.appendChild(buyNowButton);

      let buyNowLink = document.createElement("a");
      buyNowLink.href = "/TAA_FE/src/homepage/cartPage/index.html";
      buyNowLink.textContent = "Mua ngay";
      buyNowButton.appendChild(buyNowLink);

      // Append the product item to the desired container/element
      let container = document.querySelector(".product__wrapper");
      container.appendChild(productItem);
    }

      category.forEach((item) => {
        item.addEventListener("click", () => {
          const selectedCategory = item.dataset.category;
          fetch("http://localhost:3000/products/category",{
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
                  // body: JSON.stringify({ category: selectedCategory })
                  body: JSON.stringify({ category: selectedCategory })
            }).then(respone => respone.json())
              .then(data=> {
                console.log("this is data :",data.result);
                $(".product__wrapper").empty();
                data.result.forEach(item => {
                  createProduct(item);

                })
                
                

          })
        });
      });
    </script>
</body>

</html>